<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    {% extends "crm/base.html" %}
    {% block content %}
        <h2>Tutti i clienti</h2>

        <p><a href="{% url 'cliente_nuovo' %}">+ Aggiungi cliente</a></p>

        <form method="get" style="margin:10px 0; display:flex; gap:8px; flex-wrap:wrap;">
            <input type="text" name="q" value="{{ q }}" placeholder="Cerca nome, email, telefono">

            <select name="stato">
                <option value="">Tutti gli stati</option>
                <option value="active"   {% if stato == "active" %}selected{% endif %}>Attivi</option>
                <option value="inactive" {% if stato == "inactive" %}selected{% endif %}>Non Attivi</option>
                <option value="legal"    {% if stato == "legal" %}selected{% endif %}>Legale</option>
            </select>

            <input type="date" name="dal" value="{{ dal }}">
            <input type="date" name="al"  value="{{ al }}">

            <label style="display:flex; align-items:center; gap:4px;">
                <input type="checkbox" name="has_docs" value="si" {% if has_docs == "si" %}checked{% endif %}>
                Con documenti
            </label>

            <label style="display:flex; align-items:center; gap:4px;">
                <input type="checkbox" name="has_prat" value="si" {% if has_prat == "si" %}checked{% endif %}>
                Con pratiche
            </label>

            <button type="submit">Filtra</button>
            <a href="{% url 'clienti_tutti' %}">Reset</a>
        </form>

        <table border="1" cellpadding="6">
            <thead>
                <tr>
                <th>
                    <a href="?sort=nome">Nome ▲</a> | <a href="?sort=-nome">▼</a>
                </th>
                <th>
                    <a href="?sort=cognome">Cognome ▲</a> | <a href="?sort=-cognome">▼</a>
                </th>
                <th>Email</th>
                <th>Telefono</th>
                <th>Residenza</th>
                <th>Esperienza Finanziaria</th>
                <th>Visure</th>
                <th>
                    <a href="?sort=stato">Stato ▲</a> | <a href="?sort=-stato">▼</a>
                </th>
                <th>
                    <a href="?sort=data_creazione">Creato ▲</a> | <a href="?sort=-data_creazione">▼</a>
                </th>
                <th>Azioni</th>
                </tr>
            </thead>
            <tbody>
                {% for c in clienti %}
                <tr>
                    <td>{{ c.nome }}</td>
                    <td>{{ c.cognome }}</td>
                    <td>{{ c.email|default:"—" }}</td>
                    <td>{{ c.telefono|default:"—" }}</td>
                    <td>{{ c.residenza|default:"—" }}</td>
                    <td>{{ c.esperienza_finanziaria|default:"—" }}</td>
                    <td>{{ c.visure|default:"—" }}</td>
                    <td>{{ c.get_stato_display }}</td>
                    <td>{{ c.data_creazione|date:"d/m/Y H:i" }}</td>
                    <td><a href="{% url 'cliente_dettaglio' c.id %}">Apri</a></td>
                </tr>
                {% empty %}
                <tr><td colspan="10">Nessun cliente.</td></tr>
                {% endfor %}
            </tbody>
        </table>


        {% if page_obj.paginator.num_pages > 1 %}
            <div style="margin-top:10px; display:flex; gap:6px;">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}&stato={{ stato }}&dal={{ dal }}&al={{ al }}&has_docs={{ has_docs }}&has_prat={{ has_prat }}">« Prec</a>
                {% endif %}
                <span>Pagina {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}&q={{ q }}&stato={{ stato }}&dal={{ dal }}&al={{ al }}&has_docs={{ has_docs }}&has_prat={{ has_prat }}">Succ »</a>
                {% endif %}
            </div>
        {% endif %}

    {% endblock %}

</body>
</html>